{"ast":null,"code":"var _jsxFileName = \"/Users/kataokayuutarou/kataoka-dev/chat-tool/chat-tool/src/App.js\";\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport Message from './components/Message';\nimport Login from './components/Login';\nimport logo from \"./logo.svg\";\nimport './App.css';\nlet socket = null;\nconst isDevelopment = process.env.NODE_ENV === 'development';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      init: true,\n      participants: [],\n      messages: [],\n      name: \"\"\n    };\n    this.participantSubmit = this.participantSubmit.bind(this);\n    this.textSubmit = this.textSubmit.bind(this);\n  }\n\n  participantSubmit(e) {\n    e.preventDefault();\n    const input = document.getElementById(\"participant-form\").value;\n\n    if (input === \"\") {\n      return;\n    }\n\n    const location = isDevelopment ? 'localhost:8081' : document.location.host;\n    const url = \"\".concat(document.location.protocol.replace(\"http\", \"ws\"), \"//\").concat(location, \"/ws?name=\").concat(input); // init client websocket\n\n    socket = new WebSocket(url);\n\n    socket.onopen = event => {\n      console.log('Opened socket');\n    };\n\n    socket.onerror = event => {\n      console.log(event);\n    };\n\n    this.setState({\n      init: false,\n      name: input,\n      participants: []\n    });\n  }\n\n  textSubmit(e) {\n    e.preventDefault();\n    const input = document.getElementById(\"text-entry-input\").value;\n\n    if (input === \"\") {\n      return;\n    } // send message request to server\n\n\n    socket.send(JSON.stringify({\n      text: input,\n      name: this.state.name,\n      timestamp: new Date().toLocaleTimeString()\n    }));\n    document.getElementById(\"text-entry-input\").value = \"\";\n  }\n\n  componentDidUpdate() {\n    if (!this.state.init) {\n      // keep message box scrolled appropriately with new messages\n      document.getElementById(\"conversation-main\").scrollTop = document.getElementById(\"conversation-main\").scrollHeight;\n      console.log(\"componentDidUpdate\");\n\n      socket.onmessage = event => {\n        console.log(event);\n        const data = JSON.parse(event.data);\n        console.log(data);\n\n        if (!data.text) {\n          // client added\n          this.setState({\n            participants: data\n          });\n        } else {\n          // message added\n          const text = data.text,\n                name = data.name,\n                timestamp = data.timestamp;\n          this.setState({\n            messages: [...this.state.messages, {\n              text,\n              name,\n              timestamp\n            }]\n          });\n        }\n      };\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, \"go-react-chat\"), this.state.init && React.createElement(\"div\", {\n      id: \"box-init\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(Login, {\n      participantSubmit: this.participantSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    })), !this.state.init && React.createElement(\"div\", {\n      id: \"box-main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        width: \"100%\",\n        height: \"100%\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"top\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"participants-main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, React.createElement(\"b\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115\n      },\n      __self: this\n    }, \"Participants (\".concat(this.state.participants.length, \"):\")), this.state.participants.map(participant => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, participant))), React.createElement(\"div\", {\n      id: \"conversation-main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(\"a\", {\n      href: \"https://github.com/stefaluc/go-react-chat\",\n      id: \"source\",\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, \"View source code\"), this.state.messages.map(message => React.createElement(Message, {\n      message: message,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      id: \"bottom\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"text-entry-main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.textSubmit,\n      id: \"text-entry-form\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"text\",\n      id: \"text-entry-input\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    })))))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/kataokayuutarou/kataoka-dev/chat-tool/chat-tool/src/App.js"],"names":["React","Component","ReactDOM","Message","Login","socket","isDevelopment","process","env","NODE_ENV","App","constructor","props","state","init","participants","messages","name","participantSubmit","bind","textSubmit","e","preventDefault","input","document","getElementById","value","location","host","url","protocol","replace","WebSocket","onopen","event","console","log","onerror","setState","send","JSON","stringify","text","timestamp","Date","toLocaleTimeString","componentDidUpdate","scrollTop","scrollHeight","onmessage","data","parse","render","width","height","length","map","participant","message"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport Message from './components/Message';\nimport Login from './components/Login';\nimport logo from './logo.svg';\nimport './App.css';\n\nlet socket = null;\nconst isDevelopment = process.env.NODE_ENV === 'development'\n\nclass App extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            init: true,\n            participants: [],\n            messages: [],\n            name: \"\",\n        };\n\n        this.participantSubmit = this.participantSubmit.bind(this);\n        this.textSubmit = this.textSubmit.bind(this);\n    }\n\n    participantSubmit(e) {\n        e.preventDefault();\n        const input = document.getElementById(\"participant-form\").value;\n        if (input === \"\") {\n            return;\n        }\n\n        const location = isDevelopment ? 'localhost:8081' : document.location.host;\n        const url = `${document.location.protocol.replace(\"http\", \"ws\")}//${location}/ws?name=${input}`;\n        // init client websocket\n        socket = new WebSocket(url);\n        socket.onopen = (event) => {\n            console.log('Opened socket');\n        };\n        socket.onerror = (event) => {\n            console.log(event);\n        }\n        this.setState({\n            init: false,\n            name: input,\n            participants: [],\n        });\n    }\n\n    textSubmit(e) {\n        e.preventDefault();\n        const input = document.getElementById(\"text-entry-input\").value;\n        if (input === \"\") {\n            return;\n        }\n\n        // send message request to server\n        socket.send(JSON.stringify({\n            text: input,\n            name: this.state.name,\n            timestamp: new Date().toLocaleTimeString(),\n        }));\n\n        document.getElementById(\"text-entry-input\").value = \"\";\n    }\n\n    componentDidUpdate() {\n        if (!this.state.init) {\n            // keep message box scrolled appropriately with new messages\n            document.getElementById(\"conversation-main\").scrollTop = document.getElementById(\"conversation-main\").scrollHeight;\n\n            console.log(\"componentDidUpdate\")\n            socket.onmessage = (event) => {\n                console.log(event);\n                const data = JSON.parse(event.data);\n                console.log(data);\n                if (!data.text) { // client added\n                    this.setState({\n                        participants: data\n                    });\n                } else { // message added\n                    const { text, name, timestamp } = data;\n\n                    this.setState({\n                        messages: [\n                            ...this.state.messages,\n                            {\n                                text,\n                                name,\n                                timestamp,\n                            }\n                        ],\n                    });\n                }\n            }\n        }\n    }\n\n    render() {\n        return (\n            <div id=\"main\">\n                <div id=\"title\">\n                    go-react-chat\n                </div>\n                {this.state.init &&\n                    <div id=\"box-init\">\n                        <Login participantSubmit={this.participantSubmit} />\n                    </div>\n                }\n                {!this.state.init &&\n                    <div id=\"box-main\">\n                        <div style={{ width: \"100%\", height: \"100%\" }}>\n                            <div id=\"top\">\n                                <div id=\"participants-main\">\n                                    <b>{`Participants (${this.state.participants.length}):`}</b>\n                                    {this.state.participants.map(participant =>\n                                        <div>{participant}</div>\n                                    )}\n                                </div>\n                                <div id=\"conversation-main\">\n                                    <a href=\"https://github.com/stefaluc/go-react-chat\"\n                                        id=\"source\"\n                                        target=\"_blank\"\n                                        rel=\"noopener noreferrer\">View source code</a>\n                                    {this.state.messages.map(message =>\n                                        <Message message={message} />\n                                    )}\n                                </div>\n                            </div>\n                            <div id=\"bottom\">\n                                <div id=\"text-entry-main\">\n                                    <form onSubmit={this.textSubmit} id=\"text-entry-form\">\n                                        <input type=\"text\" id=\"text-entry-input\" />\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                }\n            </div>\n        );\n    }\n\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}